CONFFILES="graphite.wsgi"
for i in $CONFFILES; do
    if [ ! -f %{graphite_path}/conf/$i ]; then
        /bin/echo "No pre-existing $i - creating from example."
        /bin/cp %{graphite_path}/conf/$i.example %{graphite_path}/conf/$i;
    fi;      
done;

if [ ! -f /etc/httpd/conf.d/graphite.conf ]; then 
    /bin/echo "--IMPORTANT--"
    /bin/echo "Graphite VirtualHost configuration not found in default"
    /bin/echo "location. Graphite won't work without it. See sources for"
    /bin/echo "an example vhost configuration for WSGI!"
    /bin/echo "This script will now attempt to install the vHost file needed."
    /bin/echo "--IMPORTANT--"
    /bin/cp %{graphite_path}/examples/example-graphite-vhost.conf /etc/httpd/conf.d/graphite.conf
fi; 

/usr/bin/python %{graphite_path}/webapp/graphite/manage.py syncdb --noinput

/bin/chown -R apache.apache %{graphite_path}/storage
/bin/chown -R apache.apache %{graphite_path}/webapp
